<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>DinoForum - Home</title>
  <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
  <div class="container">
    <span class="dino-emoji">ü¶ï</span>
    <div class="dino-header">Welcome to DinoForum!</div>
    <h1>Home</h1>
    <div class="welcome-box">
        {{if .LoggedIn}}
            <span>ü¶ñ Welcome, {{.Username}}!</span>
        {{else}}
            <span>ü¶ï Welcome, guest!</span>
        {{end}}
    </div>
    {{if .LoggedIn}}
        <div class="user-links">
            <a href="/create_post" class="user-link">Create Post</a>
            <a href="/logout" class="user-link">Logout</a>
        </div>
    {{else}}
        <div class="auth-links">
            <a href="/login" class="auth-link">Login</a>
            <a href="/register" class="auth-link">Register</a>
        </div>
    {{end}}
    <hr>
    <div class="category-filter">
        <form method="GET" action="/">
            <label for="category_id">Filter by Category:</label>
            <select name="category_id" id="category_id" onchange="this.form.submit()">
                <option value="">All Categories</option>
                {{range .Categories}}
                    <option value="{{.ID}}" {{if eq $.CurrentCategory (printf "%d" .ID)}}selected{{end}}>{{.Name}}</option>
                {{end}}
            </select>
        </form>
    </div>
    <div class="filter-nav">
        <a href="/" class="{{if not .CurrentFilter}}active{{end}}">All Posts</a>
        {{if .LoggedIn}}
            <a href="/?filter=my" class="{{if eq .CurrentFilter "my"}}active{{end}}">My Posts</a>
            <a href="/?filter=liked" class="{{if eq .CurrentFilter "liked"}}active{{end}}">Liked Posts</a>
        {{end}}
    </div>
    {{if .Posts}}
        {{range .Posts}}
            <div class="post-card" data-post-id="{{.ID}}">
                <div class="post-card-clickable" onclick="goToPost('{{.ID}}')"></div>
                <h2><a href="/post?id={{.ID}}">{{.Title}}</a></h2>
                <div class="post-categories">
                    {{range .Categories}}
                        <span>{{.}}</span>
                    {{end}}
                </div>
                <div class="post-meta">
                    By <strong>{{.Author}}</strong> ¬∑ {{.Created.Format "Jan 2, 2006 15:04"}}
                </div>
                <div class="post-content">
                    {{if gt (len .Content) 120}}
                        {{slice .Content 0 120}}... <span style="color:#667eea;">[more]</span>
                    {{else}}
                        {{.Content}}
                    {{end}}
                </div>
                <div class="post-actions">
                    <div class="post-actions-left">
                        <div class="like-buttons">
                            {{if $.LoggedIn}}
                                <form action="/like" method="POST" style="display:inline;">
                                    <input type="hidden" name="post_id" value="{{.ID}}">
                                    <input type="hidden" name="is_like" value="1">
                                    <button type="submit" class="like-button">üëç <span>{{.LikeCount}}</span></button>
                                </form>
                                <form action="/like" method="POST" style="display:inline;">
                                    <input type="hidden" name="post_id" value="{{.ID}}">
                                    <input type="hidden" name="is_like" value="0">
                                    <button type="submit" class="dislike-button">üëé <span>{{.DislikeCount}}</span></button>
                                </form>
                            {{else}}
                                <span class="like-button">üëç <span>{{.LikeCount}}</span></span>
                                <span class="dislike-button">üëé <span>{{.DislikeCount}}</span></span>
                            {{end}}
                        </div>
                    </div>
                    <div class="post-actions-right">
                        {{if and $.LoggedIn (eq $.UserID .UserID)}}
                            <form action="/delete_post" method="POST" style="display:inline;">
                                <input type="hidden" name="post_id" value="{{.ID}}">
                                <button type="submit" onclick="return confirm('Are you sure you want to delete this post?')" class="delete-button">Delete Post</button>
                            </form>
                        {{end}}
                    </div>
                </div>
            </div>
        {{end}}
    {{else}}
        <p style="text-align:center; color:#388e3c;">No posts yet. Be the first dino to roar!</p>
    {{end}}
  </div>

  <footer>
    &copy; 2025 DinoForum. All rights reserved.
  </footer>
<script src="/static/js/index.js"></script>
</body>
</html>
